<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>주소 -> 좌표 일괄 변환기 (디버깅 모드)</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=e24p8s9r87&submodules=geocoder"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        textarea { width: 100%; height: 150px; margin-bottom: 10px; }
        #result { background: #f4f4f4; padding: 15px; border: 1px solid #ddd; white-space: pre-wrap; font-family: monospace; min-height: 50px; }
        #log { color: red; font-size: 13px; margin-top: 10px; }
        button { padding: 10px 20px; background: #03c75a; color: white; border: none; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <h2>좌표 추출기</h2>
    <textarea id="inputData" placeholder="엑셀 데이터를 붙여넣으세요..."></textarea>
    <br>
    <button onclick="startConversion()">변환 시작</button>
    <div id="log"></div>
    <h3>결과값:</h3>
    <div id="result"></div>

    <script>
        function startConversion() {
            const input = document.getElementById('inputData').value;
            const lines = input.trim().split('\n');
            const resultDiv = document.getElementById('result');
            const logDiv = document.getElementById('log');
            let results = [];
            let processedCount = 0;

            logDiv.innerHTML = ""; // 로그 초기화
            resultDiv.innerText = "변환 중...";

            // Geocoder가 로드되었는지 확인
            if (!naver.maps.Service || !naver.maps.Service.geocode) {
                logDiv.innerHTML = "에러: 네이버 Geocoder 서비스를 불러오지 못했습니다. ID와 Submodules 설정을 확인하세요.";
                return;
            }

            lines.forEach((line) => {
                const columns = line.split('\t');
                const title = columns[0] ? columns[0].trim() : "이름없음";
                const address = columns[1] ? columns[1].trim() : "";
                const desc = columns[2] ? columns[2].trim() : "";

                if (!address) {
                    processedCount++;
                    if (processedCount === lines.length) displayResult(results);
                    return;
                }

                naver.maps.Service.geocode({ query: address }, function(status, response) {
                    if (status === naver.maps.Service.Status.OK) {
                        const item = response.v2.addresses[0];
                        results.push({ title: title, lat: parseFloat(item.y), lng: parseFloat(item.x), desc: desc });
                    } else {
                        logDiv.innerHTML += `변환 실패: [${title}] ${address} (사유: ${status})<br>`;
                    }

                    processedCount++;
                    if (processedCount === lines.length) displayResult(results);
                });
            });
        }

        function displayResult(data) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerText = "const myLocations = " + JSON.stringify(data, null, 4) + ";";
        }
    </script>
</body>
</html>